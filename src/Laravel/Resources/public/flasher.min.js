!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).flasher={})}(this,(function(e){"use strict";function t(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class s{success(e,t,s){this.flash("success",e,t,s)}error(e,t,s){this.flash("error",e,t,s)}info(e,t,s){this.flash("info",e,t,s)}warning(e,t,s){this.flash("warning",e,t,s)}flash(e,t,s,n){const i={type:e,message:t,title:s||e,options:n||{},metadata:{plugin:""}};this.renderOptions(n||{}),this.renderEnvelopes([i])}}class n extends s{constructor(e){super(),this.options={timeout:5e3,fps:30,position:"top-right",direction:"top",rtl:!1,style:{},darkMode:"media"},this.theme=e}renderEnvelopes(e){const t=e=>{e.forEach((e=>{const t=Object.assign(Object.assign({},this.options),e.options),s=this.createContainer(t);this.addToContainer(s,e,t)}))};["interactive","complete"].includes(document.readyState)?t(e):document.addEventListener("DOMContentLoaded",(()=>t(e)))}renderOptions(e){this.options=Object.assign(Object.assign({},this.options),e),this.applyDarkMode()}createContainer(e){let t=document.querySelector(`.fl-main-container[data-position="${e.position}"]`);return t?(t.dataset.turboCache="false",t):(t=document.createElement("div"),t.classList.add("fl-main-container"),t.dataset.position=e.position,t.dataset.turboCache="false",Object.keys(e.style).forEach((s=>{t.style.setProperty(s,e.style[s])})),document.body.append(t),t)}addToContainer(e,t,s){const n=this.stringToHTML(this.theme.render(t));n.classList.add("fl-container"),this.appendNotification(e,n,s),this.renderProgressBar(n,s),this.handleClick(n)}appendNotification(e,t,s){"bottom"===s.direction?e.append(t):e.prepend(t),s.rtl&&t.classList.add("fl-rtl"),requestAnimationFrame((()=>t.classList.add("fl-show")))}removeNotification(e){const t=e.parentElement;e.classList.remove("fl-show"),e.addEventListener("transitionend",(()=>{e.remove(),t.hasChildNodes()||t.remove()}))}handleClick(e){e.addEventListener("click",(()=>this.removeNotification(e)))}renderProgressBar(e,{timeout:t,fps:s}){var n;if(!t||t<=0)return;const i=document.createElement("span");i.classList.add("fl-progress"),null===(n=e.querySelector(".fl-progress-bar"))||void 0===n||n.append(i);const o=100/(t/(1e3/s));let r=0;const a=()=>{r+=o,i.style.width=`${r}%`,r>=100&&(clearInterval(l),this.removeNotification(e))};let l;const d=()=>{l=window.setInterval(a,1e3/s)};e.addEventListener("mouseover",(()=>{clearInterval(l)})),e.addEventListener("mouseout",d),d()}applyDarkMode(){const[e,t="dark"]=[].concat(this.options.darkMode),s="media"===e&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches||"class"===e&&document.body.classList.contains(t);document.body.classList.toggle("fl-dark",s)}stringToHTML(e){const t=document.createElement("div");return t.innerHTML=e.trim(),t.firstElementChild}}const i=new class extends s{constructor(){super(...arguments),this.defaultPlugin="flasher",this.plugins=new Map,this.themes=new Map}render(e){return t(this,void 0,void 0,(function*(){const t=this.resolveResponse(e);yield Promise.all([this.addStyles(t.styles),this.addScripts(t.scripts)]),this.renderOptions(t.options),this.renderEnvelopes(t.envelopes)}))}renderEnvelopes(e){const t={};e.forEach((e=>{const s=this.resolvePluginAlias(e.metadata.plugin);t[s]=t[s]||[],t[s].push(e)})),Object.entries(t).forEach((([e,t])=>{this.create(e).renderEnvelopes(t)}))}renderOptions(e){Object.entries(e).forEach((([e,t])=>{this.create(e).renderOptions(t)}))}addPlugin(e,t){this.plugins.set(e,t)}addTheme(e,t){this.themes.set(e,t)}setDefault(e){return this.defaultPlugin=e,this}create(e){e=this.resolvePluginAlias(e),this.resolvePlugin(e);const t=this.plugins.get(e);if(!t)throw new Error(`Unable to resolve "${e}" plugin, did you forget to register it?`);return t}addStyles(e){return t(this,void 0,void 0,(function*(){yield this.addAssets(e,"link","href","stylesheet")}))}addScripts(e){return t(this,void 0,void 0,(function*(){yield this.addAssets(e,"script","src","text/javascript")}))}resolveResponse(e){const t=Object.assign({envelopes:[],options:{},scripts:[],styles:[],context:{}},e);return Object.entries(t.options).forEach((([e,s])=>{t.options[e]=this.resolveOptions(s)})),t.envelopes.forEach((e=>{e.metadata=e.metadata||{},e.metadata.plugin=this.resolvePluginAlias(e.metadata.plugin),this.addThemeStyles(t,e.metadata.plugin),e.options=this.resolveOptions(e.options)})),t}resolveOptions(e){return Object.entries(e).forEach((([t,s])=>{e[t]=this.resolveFunction(s)})),e}resolveFunction(e){var t,s;if("string"!=typeof e)return e;const n=e.match(/^function(?:.+)?(?:\s+)?\((.+)?\)(?:\s+|\n+)?{(?:\s+|\n+)?((?:.|\n)+)}$/m);if(!n)return e;const i=null!==(s=null===(t=n[1])||void 0===t?void 0:t.split(",").map((e=>e.trim())))&&void 0!==s?s:[],o=n[2];return new Function(...i,o)}resolvePlugin(e){if(this.plugins.get(e)||!e.includes("theme."))return;const t=this.themes.get(e.replace("theme.",""));t&&this.addPlugin(e,new n(t))}resolvePluginAlias(e){return"flasher"===(e=e||this.defaultPlugin)?"theme.flasher":e}addAssets(e,s,n,i){return t(this,void 0,void 0,(function*(){const t=e.map((e=>new Promise((t=>{if(null!==document.querySelector(`${s}[${n}="${e}"]`))return void t();const o=document.createElement(s);o[n]=e,"link"===s?o.rel=i:"script"===s&&(o.type=i),o.onload=()=>t(),document.head.appendChild(o)}))));yield Promise.all(t)}))}addThemeStyles(e,t){var s;if("flasher"!==t&&!t.includes("theme."))return;t=t.replace("theme.","");const n=(null===(s=this.themes.get(t))||void 0===s?void 0:s.styles)||[];e.styles=Array.from(new Set([...e.styles,...n]))}};i.addTheme("flasher",{render:e=>{const{type:t,title:s,message:n}=e;return`\n      <div class="fl-flasher fl-${t}">\n        <div class="fl-content">\n          <div class="fl-icon"></div>\n          <div>\n            <strong class="fl-title">${s}</strong>\n            <span class="fl-message">${n}</span>\n          </div>\n        </div>\n        <span class="fl-progress-bar"></span>\n      </div>`}}),window.flash=i,e.AbstractPlugin=s,e.flasher=i}));
//# sourceMappingURL=flasher.min.js.map
